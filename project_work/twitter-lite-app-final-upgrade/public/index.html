
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mini Twitter ‚Äî Styled</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="brand card">
        <div class="logo">üê¶</div>
        <div>
          <div style="font-weight:800;font-size:18px">Mini Twitter</div>
          <div style="color:var(--muted);font-size:13px">A lightweight demo</div>
        </div>
      </div>
      <nav class="nav" style="margin-top:16px">
        <a href="/" style="color:var(--accent);">Home</a>
        <a href="/explore.html">Explore</a>
        <a href="/notifications.html">Notifications</a>
        <a href="/messages.html">Messages</a>
      </nav>
      <div style="margin-top:18px" class="card">
        <div style="font-weight:700;margin-bottom:8px">Profile</div>
        <div id="profileArea"> <a href="/login.html" style="color:var(--muted)">Login or Register</a> </div>
      </div>
    </aside>

    <main class="main">
      <section class="card">
        <div class="header">
          <h2>Home</h2>
          <div id="rightHeader" class="auth-links"></div>
        </div>

        <div id="composer" class="tweet-box" style="display:none">
          <div class="avatar">V</div>
          <div class="tweet-input">
            <input id="tweetUser" type="text" placeholder="Username" style="display:none"/>
            <textarea id="tweetText" rows="3" placeholder="What's happening?"></textarea>
            <div class="tweet-row">
              <div style="color:var(--muted);font-size:13px">0 / 280</div>
              <div>
                <button id="tweetBtn" class="button">Tweet</button>
              </div>
            </div>
          </div>
        </div>

        <div id="loginNotice" style="padding:12px;color:var(--muted);display:none">
          Please <a href="/login.html">login</a> to post tweets.
        </div>

        <div class="timeline" id="tweets"></div>
      </section>
    </main>
  </div>

<script>
// JS logic for auth and tweets (same as before)
// get current user
async function getMe() {
  const token = localStorage.getItem('token');
  if (!token) return null;
  try {
    const res = await fetch('/api/me', { headers: { Authorization: 'Bearer ' + token } });
    if (!res.ok) { localStorage.removeItem('token'); return null; }
    return await res.json();
  } catch (e) { return null; }
}

async function loadTweets() {
  const res = await fetch('/api/tweets');
  const tweets = await res.json();
  const container = document.getElementById('tweets');
  container.innerHTML = '';
  tweets.forEach(t => {
    const div = document.createElement('div');
    div.className = 'tweet card';
    div.innerHTML = `<div style="width:56px"><div class="avatar" style="width:44px;height:44px;border-radius:50%">${(t.user||'A').slice(0,1).toUpperCase()}</div></div>
      <div style="flex:1">
        <div class="meta">${t.user}</div>
        <div class="text">${t.text}</div>
        <div style="color:var(--muted);font-size:12px;margin-top:8px">${new Date(t.createdAt).toLocaleString()}</div>
      </div>`;
    container.appendChild(div);
  });
}

document.getElementById('tweetBtn').addEventListener('click', async () => {
  const token = localStorage.getItem('token');
  const text = document.getElementById('tweetText').value;
  if (!token) { alert('Please login'); window.location.href = '/login.html'; return; }
  const res = await fetch('/api/tweets', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', Authorization: 'Bearer ' + token },
    body: JSON.stringify({ text })
  });
  if (!res.ok) { const d = await res.json(); alert(d.message||d.error||JSON.stringify(d)); return; }
  document.getElementById('tweetText').value = '';
  loadTweets();
});

// on load, set UI
(async () => {
  await loadTweets();
  const me = await getMe();
  const rightHeader = document.getElementById('rightHeader');
  const composer = document.getElementById('composer');
  const loginNotice = document.getElementById('loginNotice');
  const profileArea = document.getElementById('profileArea');
  rightHeader.innerHTML = '';
  if (me && me.username) {
    rightHeader.innerHTML = `<span style="color:var(--muted);margin-right:8px">Logged in as <strong>${me.username}</strong></span><button id="logout" class="button ghost">Logout</button>`;
    composer.style.display = 'flex';
    loginNotice.style.display = 'none';
    profileArea.innerHTML = '<div style="font-weight:700;color:#dbeafe">'+me.username+'</div>';
    document.getElementById('logout').addEventListener('click', ()=>{ localStorage.removeItem('token'); window.location.href='/login.html'; });
  } else {
    rightHeader.innerHTML = '<a class="cta" href="/login.html" style="padding:8px 12px;border-radius:10px;background:var(--accent);color:white;text-decoration:none">Login</a>';
    composer.style.display = 'none';
    loginNotice.style.display = 'block';
    profileArea.innerHTML = '<a href="/login.html" style="color:var(--muted)">Login or Register</a>';
  }
})();
</script>
</body>
</html>
